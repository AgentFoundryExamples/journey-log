# Service Configuration
# The environment the service is running in (dev, staging, prod)
SERVICE_ENVIRONMENT=dev

# The name of this service
SERVICE_NAME=journey-log

# Google Cloud Platform Configuration
# GCP Project ID for the service
GCP_PROJECT_ID=jb-infinite-dungeon-master

# Firestore Configuration
# Default Firestore collection for journeys
FIRESTORE_JOURNEYS_COLLECTION=journeys

# Default Firestore collection for entries
FIRESTORE_ENTRIES_COLLECTION=entries

# Firestore collection for character documents
# Used by cleanup scripts and character API endpoints
FIRESTORE_CHARACTERS_COLLECTION=characters

# Firestore collection for connectivity tests
FIRESTORE_TEST_COLLECTION=connectivity_test

# Firestore emulator host for local development (e.g., localhost:8080)
# Leave empty to use real Firestore with Application Default Credentials
FIRESTORE_EMULATOR_HOST=

# Build Metadata (Optional)
# Version/tag of the current build
BUILD_VERSION=0.1.0

# Git commit SHA of the current build
BUILD_COMMIT=

# Build timestamp (ISO 8601 format)
BUILD_TIMESTAMP=

# API Configuration
# Host to bind the server to (use 0.0.0.0 for containers)
API_HOST=127.0.0.1

# Port to bind the server to
API_PORT=8080

# Logging Configuration
# Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
LOG_LEVEL=INFO

# Request ID header name (for Cloud Run/Load Balancer compatibility)
# Cloud Run uses X-Request-ID, but you can customize this if needed
REQUEST_ID_HEADER=X-Request-ID

# Narrative Turns Configuration
# Default number of narrative turns to retrieve in queries (1-100)
NARRATIVE_TURNS_DEFAULT_QUERY_SIZE=10

# Maximum number of narrative turns that can be retrieved in a single query (1-1000)
NARRATIVE_TURNS_MAX_QUERY_SIZE=100

# Maximum length of user_action field in narrative turns (characters)
NARRATIVE_TURNS_MAX_USER_ACTION_LENGTH=8000

# Maximum length of ai_response field in narrative turns (characters)
NARRATIVE_TURNS_MAX_AI_RESPONSE_LENGTH=32000

# Context Aggregation Configuration
# Default number of recent narrative turns to include in context aggregation
# Must be <= CONTEXT_RECENT_N_MAX (validated at startup)
# Recommended range: 1-100 for optimal performance (default: 20)
# Firestore read pattern: 1 character doc + 1 narrative query + optional 1 POI query
CONTEXT_RECENT_N_DEFAULT=20

# Maximum number of recent narrative turns that can be requested in context aggregation
# Higher values increase payload size and memory usage (default: 100, absolute max: 1000)
# Requests exceeding this value will be rejected with 422 validation error
# This limit ensures context payloads remain manageable for LLM/Director consumption
CONTEXT_RECENT_N_MAX=100

# Maximum number of POIs to sample for context aggregation
# Valid range: 1-20. If more POIs exist, random sampling is used.
# If fewer POIs exist than this value, all available POIs are returned.
# Note: POI queries are always bounded by this configured cap to control Firestore reads
CONTEXT_POI_CAP=3

# POI Storage Configuration
# Enable automatic copy-on-write POI migration from embedded array to subcollection
# When true, the first POI write triggers migration of embedded POIs
# When false, only manual migration is available
POI_MIGRATION_ENABLED=true

# Enable reading from embedded world_pois array as fallback when subcollection is empty
# This ensures backward compatibility during migration
# Set to false to only read from subcollection (post-migration)
POI_EMBEDDED_READ_FALLBACK=true
